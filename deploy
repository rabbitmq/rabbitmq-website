#!/bin/sh

set -e

remote_host=$1

if [ x"$remote_host" = x ] ; then
    echo 'Usage: deploy <host to deploy to>'
fi

echo Deploying to $remote_host

tmp_dir=$(ssh $remote_host mktemp -d)

scp -r -q code conf site $remote_host:$tmp_dir
ssh -t $remote_host sudo $tmp_dir/code/deploy-remote
ssh $remote_host rm -rf $tmp_dir

