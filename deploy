#!/bin/sh

set -e

remote_host=$1

if [ x"$remote_host" = x ] ; then
    echo 'Usage: deploy <host to deploy to>'
fi

echo Deploying to $remote_host

deploy_dir=/tmp/website-deploy-$(hg branch)

ssh $remote_host mkdir -p $deploy_dir
rsync -avz --delete code conf site wordpress-theme $remote_host:$deploy_dir
ssh -t $remote_host sudo $deploy_dir/code/deploy-remote
