<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xml" href="page.xsl"?>
<!--
Copyright (C) 2007-2015 Pivotal Software, Inc. 

All rights reserved. This program and the accompanying materials
are made available under the terms of the under the Apache License, 
Version 2.0 (the "License”); you may not use this file except in compliance 
with the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:doc="http://www.rabbitmq.com/namespaces/ad-hoc/doc"
      xmlns:x="http://www.rabbitmq.com/2011/extensions">
  <head>
    <title>Validated User-ID</title>
  </head>
  <body>
    <p>
      In some scenarios it is useful for consumers to be able
      to know the identity of the user who published a
      message. We have therefore made sure that
      the <code>user-id</code> message property is validated. If
      this property is set by a publisher, its value must be equal
      to the name of the user used to open the connection. If
      the <code>user-id</code> property is not set, the
      publisher's identity remains private.
    </p>
    <p>
      For example (in Java):
    </p>
    <pre class="sourcecode">
AMQP.BasicProperties properties = new AMQP.BasicProperties();
properties.setUserId("guest");
channel.basicPublish("amq.fanout", "", properties, "test".getBytes());</pre>
    <p>
      This message will only be published successfully if the user
      is "guest".
    </p>
    <p>
      If security is a serious concern, you should probably
      combine the use of this feature
      with <a href="ssl.html">SSL</a> based connections.
    </p>
    <p>
      Occasionally it may be useful to allow an application to forge a
      user-id. In order to permit this, the publishing user can have
      its <code>impersonator</code> tag set. By default, no users have
      this tag set. In particular, the <code>administrator</code> tag
      does not allow this.
    </p>
    <p>
      The <a href="federation.html">federation plugin</a> can deliver
      messages from an upstream on which the <code>user-id</code>
      property is set. By default it will clear this property (since
      it has no way to know whether the upstream broker is
      trustworthy). If the <code>trust-user-id</code> property on an
      upstream is set, then it will pass the <code>user-id</code>
      property through from the upstream broker, assuming it to have
      been validated there.
    </p>
  </body>
</html>
